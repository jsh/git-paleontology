#!/bin/bash -eux

gbin=~/git
PATH=$gbin:$PATH

if type -p init-db > /dev/null; then
  git-init-db() {
    init-db "$@"
  }
fi

if type -p update-cache > /dev/null; then
  git-update-cache() {
    update-cache "$@"
  }
fi

if type -p cat-file > /dev/null; then
  git-cat-file() {
    cat-file "$@"
  }
fi

if type -p diff-files > /dev/null; then
  git-diff-files() {
    diff-files "$@"
  }
elif type -p show-diff > /dev/null; then
  git-diff-files() {
    show-diff "$@"
  }
fi


if type -p write-tree > /dev/null; then
  git-write-tree() {
    write-tree "$@"
  }
fi

if type -p commit-tree > /dev/null; then
  git-commit-tree() {
    commit-tree "$@"
  }
fi

empty-blob() {
 pushd .git/objects
 find . -type f | grep e6 | tr -d './'
 pushd ~-
}

cd /tmp
[ -d test ] && rm -rf test
mkdir test
cd $_

git-init-db
touch empty-file
git-update-cache --add empty-file

empty_blob=$(empty-blob)
git-cat-file -t $empty_blob
git-cat-file "blob" $empty_blob
echo 'echo hello-world' > empty-file 
#git-diff-files -p empty-file # earlier is show-diff
#git-diff-files empty-file
> empty-file
git-write-tree
tree .git
echo "Initial commit" | git-commit-tree $(git-write-tree) > .git/HEAD

